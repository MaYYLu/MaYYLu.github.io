<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"بحث...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="前言代码审计,是对应用程序源代码进行系统性检查的工作。 目的是为了找到并且修复应用程序在开发阶段存在的一些漏洞或者程序逻辑错误,避免程序漏洞被非法利用给企业带来不必要的风险.">
<meta property="og:type" content="article">
<meta property="og:title" content="php 审计基础">
<meta property="og:url" content="http://example.com/2022/07/11/php%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="mayylu">
<meta property="og:description" content="前言代码审计,是对应用程序源代码进行系统性检查的工作。 目的是为了找到并且修复应用程序在开发阶段存在的一些漏洞或者程序逻辑错误,避免程序漏洞被非法利用给企业带来不必要的风险.">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/1567560448_5d6f13004035f.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715223832.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715211205.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/l4sij.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/se6sc.png">
<meta property="article:published_time" content="2022-07-11T13:04:19.000Z">
<meta property="article:modified_time" content="2022-08-09T02:10:23.053Z">
<meta property="article:author" content="mayylu">
<meta property="article:tag" content="php">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/1567560448_5d6f13004035f.png">


<link rel="canonical" href="http://example.com/2022/07/11/php%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"http://example.com/2022/07/11/php%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/","path":"2022/07/11/php审计基础/","title":"php 审计基础"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>php 审计基础 | mayylu</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="تشغيل شريط التصفح" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">mayylu</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          المحتويات
        </li>
        <li class="sidebar-nav-overview">
          عام
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-number">2.</span> <span class="nav-text">基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E9%A2%84%E5%8F%98%E9%87%8F"><span class="nav-number">2.1.</span> <span class="nav-text">php预变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E7%9F%AD%E6%A0%87%E7%AD%BE"><span class="nav-number">2.2.</span> <span class="nav-text">php短标签</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#php%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">php文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="nav-number">3.1.</span> <span class="nav-text">目录操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">3.2.</span> <span class="nav-text">文件操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="nav-number">3.3.</span> <span class="nav-text">文件写入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-number">3.4.</span> <span class="nav-text">文件读取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%B5%8B"><span class="nav-number">4.</span> <span class="nav-text">检测</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%95%E8%BF%87"><span class="nav-number">5.</span> <span class="nav-text">绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#md5%E7%BB%95%E8%BF%87"><span class="nav-number">5.1.</span> <span class="nav-text">md5绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A3%80%E6%B5%8B%E7%BB%95%E8%BF%87"><span class="nav-number">5.2.</span> <span class="nav-text">字符串检测绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">利用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC"><span class="nav-number">6.1.</span> <span class="nav-text">为变量赋值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rce"><span class="nav-number">6.2.</span> <span class="nav-text">rce</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="nav-number">6.2.1.</span> <span class="nav-text">代码执行</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">6.3.</span> <span class="nav-text">命令执行</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">mayylu</p>
  <div class="site-description" itemprop="description">关注生活的点点滴滴</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">المقالات</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">الوسوم</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/11/php%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mayylu">
      <meta itemprop="description" content="关注生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mayylu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          php 审计基础
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2022-07-11 21:04:19" itemprop="dateCreated datePublished" datetime="2022-07-11T21:04:19+08:00">2022-07-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2022-08-09 10:10:23" itemprop="dateModified" datetime="2022-08-09T10:10:23+08:00">2022-08-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>代码审计,是对应用程序源代码进行系统性检查的工作。 目的是为了找到并且修复应用程序在开发阶段存在的一些漏洞或者程序逻辑错误,避免程序漏洞被非法利用给企业带来不必要的风险.</p>
<span id="more"></span>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="php预变量"><a href="#php预变量" class="headerlink" title="php预变量"></a>php预变量</h3><p>　　$_SERVER[‘SERVER_ADDR’] 当前运行脚本所在的服务器的ip地址。</p>
<p>　　$_SERVER[‘SERVER_NAME’] 当前运行脚本所在服务器主机的名称。</p>
<p>　　$_SERVER[‘REQUEST_METHOD’] 访问页面时的请求方法。</p>
<p>　　$_SERVER[‘REMOTE_ADDR’] 正在浏览当前页用户的ip地址。</p>
<p>　　$_SERVER[‘HTTP_X_FORWARDED_FOR’] 透过代理服务器取得客户端的真实 IP 地址</p>
<p>　　$_SERVER[‘REMOTE_HOST’] 正在浏览当前页用户的主机名。</p>
<p>　　$_SERVER[‘REMOTE_PORT’] 用户连接到服务器时所使用的端口。</p>
<p>　　$_SERVER[‘SCRIPT_FILENAME’] 当前执行脚本的绝对路径。</p>
<p>　　$_SERVER[‘SERVER_PORT’] 服务器所使用的端口。</p>
<p>　　$_SERVER[‘SERVER_SIGNATURE’] 包含服务器版本和虚拟主机名的字符串。</p>
<p>　　$_SERVER[‘DOCUMENT_ROOT’] 当前运行脚本所在的文档根目录。</p>
<p>　　$_COOKIE 通过HTTPCookie传递到脚本的信息。这些是由执行php脚本时，通过setcookie()设置的。</p>
<p>　　$_SESSION 包含与所有会话变量有关的信息。$_SESSION变量主要应用于会话控制和页面间值的传递。</p>
<p>　　$_POST 通过post方法传递的参数信息。</p>
<p>　　$_GET 通过get方法传递的参数信息。</p>
<pre><code>$_GLOBALS 由所有已定义的全局变量组成的数组。变量名就是该数组的索引。它可以称得上是所有超级变 量的超级集合。
</code></pre>
<p>PHP的字符串解析特性<br>值得注意的是，查询字符串在解析的过程中会将某些字符删除或用下划线代替。例如，<code>/?%20news[id%00=42会转换为Array([news_id] =&gt; 42)</code>。<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/1567560448_5d6f13004035f.png" alt="1567560448_5d6f13004035f"></p>
<h3 id="php短标签"><a href="#php短标签" class="headerlink" title="php短标签"></a>php短标签</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=&quot;1&quot;?&gt;	    //相当于&lt;?php echo &quot;1&quot;;?&gt;</span><br><span class="line">&lt;?echo&quot;1&quot;?&gt;     //前提是开启配置参数short_open_tags=on</span><br><span class="line">&lt;% echo&quot;1&quot;;%&gt;	//前提是开启配置参数asp_tags=on，php7.0及以上版本不能使用</span><br></pre></td></tr></table></figure>
<h2 id="php文件操作"><a href="#php文件操作" class="headerlink" title="php文件操作"></a>php文件操作</h2><h3 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h3><p>rmdir           删除目录<br>​is_dir()        函数检查指定的文件是否是目录。<br>mkdir           创建目录<br>scandir()       函数返回一个数组，其中包含指定路径中的文件和目录</p>
<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><p>move_uploaded_file  (临时上传文件路径,目标文件路径);//移动临时上传文件<br>unlink              删除文件<br>copy                复制文件copy($file, $newfile);<br>file_exists()       函数检查文件或目录是否存在。</p>
<h3 id="文件写入"><a href="#文件写入" class="headerlink" title="文件写入"></a>文件写入</h3><p>file_put_contents   将一个字符串写入文件file_put_contents(“1.txt”,”6666”);参数 data 也可以是数组（但不能是多维数组）</p>
<p>$fp = fopen(文件路径, “w”);//以写入模式打开一个文件 返回文件指针(不存在会自动创建)<br>fwrite($fp,写入字符串);//写入数据<br>fclose($fp);//关闭文件</p>
<h3 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h3><p>file_get_contents           读入文件返回字符串，echo file_get_contents(“flag.txt”); echo file_get_contents(“<a target="_blank" rel="noopener" href="https://www.bilibili.com/&quot;">https://www.bilibili.com/&quot;</a>);<br>readfile                    读取一个文件，写入到输出缓冲区，并返回从文件中读入的字节数<br>file                        把整个文件读入一个数组中echo implode(‘’, file(‘<a target="_blank" rel="noopener" href="https://www.bilibili.com/&#39;">https://www.bilibili.com/&#39;</a>));<br>highlight_file/show_source  语法高亮一个文件highlight_file(“1.php”);<br>parse_ini_file              读取并解析一个ini配置文件print_r(parse_ini_file(‘1.ini’));<br>simplexml_load_file         读取文件作为XML文档解析</p>
<p>​fopen/fread/fgets/fgetss /fgetc/fgetcsv/fpassthru/fscanf打开文件或者 URL 读取文件流<br>$file = fopen(“test.txt”,”r”); echo fread($file,”1234”); fclose($file);</p>
<h2 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h2><ol>
<li>php正则表达式(PCRE)</li>
</ol>
<ul>
<li>preg_match(返回 pattern 的匹配结果，0 （不匹配）或 1 )</li>
<li>preg_match_all(所有匹配 pattern 给定正则表达式的匹配结果并且将它们以 flag 指定顺序输出到$array数组中,返回值为完整匹配次数，输出的 $array 数组中，$array[0]保存完整模式的所有匹配, $array[1] 保存第一个子组的所有匹配)作用相当于python中的re.findall()</li>
<li>preg_replace($pattern, $replacement, $subject),如果 subject 是一个数组， preg_replace() 返回一个数组， 其他情况下返回一个字符串.<br>(如果匹配被查找到，替换后的 subject 被返回，其他情况下 返回没有改变的 subject。如果发生错误，返回 NULL。)<h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2></li>
</ul>
<h3 id="md5绕过"><a href="#md5绕过" class="headerlink" title="md5绕过"></a>md5绕过</h3><ol>
<li><p>md5的弱比较绕过<br>0e开头且e后为数字可以被解析成科学计数法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">这里附上常见的0E开头的MD5</span><br><span class="line">0e开头的md5和原值：</span><br><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line">240610708</span><br><span class="line">0e462097431906509019562988736854</span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">0e215962017</span><br><span class="line">0e291242476940776845150308577824</span><br></pre></td></tr></table></figure></li>
<li><p>md5的强比较绕过<br>强类型比较(===),判断内容的基础上,还会判断类型是否相同<br>但md5不能加密数组,传入数组会报错,但会继续执行并且返回结果为null，所以md5加密后的结果是下面这样<code>null===null</code>,结果返回true</p>
</li>
<li><p>MD5碰撞<br>MD5碰撞也叫哈希碰撞,是指两个不同内容的输入,经过散列算法后,得到相同的输出,也就是两个不同的值的散列值相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line">b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure></li>
<li><p>md5($pass,true)的绕过<br>string    必需。要计算的字符串。<br>raw    默认不写为FALSE：32位16进制的字符串，TRUE：16位原始二进制格式的字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">content: ffifdyop</span><br><span class="line">hex: 276f722736c95d99e921722cf9ed621c</span><br><span class="line">raw: &#x27;or&#x27;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span><br><span class="line">string: &#x27;or&#x27;6]!r,b</span><br><span class="line"></span><br><span class="line">content: 129581926211651571912466741651878684928</span><br><span class="line">hex: 06da5430449f8f6f23dfc1276f722738</span><br><span class="line">raw: \x06\xdaT0D\x9f\x8fo#\xdf\xc1&#x27;or&#x27;8</span><br><span class="line">string: T0Do#&#x27;or&#x27;8</span><br></pre></td></tr></table></figure>
<p>在mysql里面，在用作布尔型判断时,以数字开头的字符串会被当做整型数，那么返回值也是true。</p>
<h3 id="字符串检测绕过"><a href="#字符串检测绕过" class="headerlink" title="字符串检测绕过"></a>字符串检测绕过</h3></li>
<li><p>strcmp() 函数比较两个字符串(适用5.3版本以前的php)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$str１ = &quot;aixuexiwang.com&quot;；</span><br><span class="line">$str２ = &quot;aixuexiwang.com&quot;；</span><br><span class="line">$str３ = &quot;aixuexiwang&quot;；</span><br><span class="line">echo　strcmp($str１，$str2)；　　//输出结果为0，因为，两个字符串相等。</span><br><span class="line">echo　strcmp($str１，$str３)；　　//输出结果为4，因为，参数１比参数２，多了４个字符。</span><br><span class="line">echo　strcmp($str3，$str１)；　　//输出结果为-4，因为，参数１比参数２少了４个字符。</span><br><span class="line"></span><br><span class="line">$str4 = &quot;abc&quot;；</span><br><span class="line">$str5 = &quot;ABC&quot;；</span><br><span class="line">echo　strcmp($str4，$str5)；　　//输出结果为1，因为，区分大小写。</span><br><span class="line">echo　strcmp($str5，$str4)；　　//输出结果为－1，因为，区分大小写。</span><br><span class="line">echo　strcasecmp($str4，$str5)；　　//输出结果为0，因为，不区分大小写，所以，相等。</span><br></pre></td></tr></table></figure>
<p>strcmp()在比较字符串和数组的时候直接返回0，可用于绕过。</p>
</li>
</ol>
<p>ereg()与strpos()两个函数同样不能用数组作为参数，否则返回<strong>NULL</strong>。<br>2. ereg()类似于preg_match但发现模式会返回true，否则返回false(PHP 5.3后已弃用)<br>eregi函数还可以使用%00来进行截断匹配<br>3. strpos() f函数查找字符串在另一字符串中第一次出现的位置（区分大小写）,如果没有找到字符串则返回 FALSE(字符串位置从 0 开始，不是从 1 开始。)<br>相关函数：<br>strrpos() - 查找字符串在另一字符串中最后一次出现的位置（区分大小写）<br>stripos() - 查找字符串在另一字符串中第一次出现的位置（不区分大小写）<br>strripos() -查找字符串在另一字符串中最后一次出现的位置（不区分大小写）<br>4. preg_match绕过</p>
<ul>
<li><p>数组绕过<br>preg_match只能处理字符串，当传入的subject是数组时会返回<strong>false</strong></p>
</li>
<li><p>在非多行模式(没有m修饰符)利用%0a绕过<br>非多行模式下，preg_match只能识别一行<br>如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&#x27;/^.*(flag).*$/&#x27;, $json)) &#123;</span><br><span class="line">    echo &#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">只需要</span><br><span class="line">$json=&quot;%0aflag&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="5">
<li>intval() 函数用于获取变量的整数值<br>成功时返回 var 的 integer 值，失败时返回 0。 空的 array 返回 0，非空的 array 返回 1。</li>
</ol>
<p>最大的值取决于操作系统。 32 位系统最大带符号的 integer 范围是 -2147483648 到 2147483647。举例，在这样的系统上， intval(‘1000000000000’) 会返回 2147483647。64 位系统上，最大带符号的 integer 值是 9223372036854775807。</p>
<p>字符串有可能返回 0，虽然取决于字符串最左侧的字符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//echo intval(~~100);                 //100</span><br><span class="line">//echo intval(&quot;1000&quot;);                //1000</span><br><span class="line">//echo intval(&#x27;10ab&#x27;);                //10</span><br><span class="line">//echo intval(100*10);                // 1000</span><br><span class="line">//echo intval(&#x27;100*10&#x27;);              // 100</span><br><span class="line">//echo intval(111^101);               //按位异或010</span><br><span class="line">//echo intval(1001|0101);             //按位或1101</span><br><span class="line">echo intval(42);                      // 42</span><br><span class="line">echo intval(4.2);                     // 4</span><br><span class="line">echo intval(&#x27;42&#x27;);                    // 42</span><br><span class="line">echo intval(&#x27;+42&#x27;);                   // 42</span><br><span class="line">echo intval(&#x27;-42&#x27;);                   // -42</span><br><span class="line">echo intval(042);                     // 34</span><br><span class="line">echo intval(&#x27;042&#x27;);                   // 42</span><br><span class="line">echo intval(1e10);                    // 1410065408</span><br><span class="line">echo intval(&#x27;1e10&#x27;);                  // 1</span><br><span class="line">echo intval(0x1A);                    // 26</span><br><span class="line">echo intval(42000000);                // 42000000</span><br><span class="line">echo intval(420000000000000000000);   // 0</span><br><span class="line">echo intval(&#x27;420000000000000000000&#x27;); // 2147483647</span><br><span class="line">echo intval(42, 8);                   // 42</span><br><span class="line">echo intval(&#x27;42&#x27;, 8);                 // 34</span><br><span class="line">echo intval(array());                 // 0</span><br><span class="line">echo intval(array(&#x27;foo&#x27;, &#x27;bar&#x27;));     // 1</span><br></pre></td></tr></table></figure>
<h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><h3 id="为变量赋值"><a href="#为变量赋值" class="headerlink" title="为变量赋值"></a>为变量赋值</h3><p><strong>file_get_contents</strong>()函数将整个文件读入一个字符串中,并返回这个值，我们也可以利用<code>php://input</code>或<code>data://text/plain,</code>自定义参数值</p>
<p><strong>extract</strong>()函数：从数组中将变量导入当前符号表。<br>定义：<br>从数组中将变量导入到当前的符号表<br>该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量<br>语法：extract(array,extract_rules,prefix),array,必需，要使用的数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a=&quot;hello&quot;;</span><br><span class="line">$b= array(&#x27;a&#x27; =&gt;&quot;world&quot; ,&quot;b&quot;=&gt;&quot;gogogo&quot;);</span><br><span class="line">extract($b);</span><br><span class="line">echo $a;		//world</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>如上所示，会存在一个覆盖漏洞。</p>
<p>call_user_func<br>把第一个参数作为回调函数调用 需要两个参数都完全可控才可利用 只能传入一个参数调用<br>call_user_func(‘assert’, ‘phpinfo();’);</p>
<p>call_user_func_array<br>同call_user_func 可传入一个数组带入多个参数调用函数<br>call_user_func_array (‘file_put_contents’, [‘1.txt’,’6666’]);</p>
<h3 id="rce"><a href="#rce" class="headerlink" title="rce"></a>rce</h3><h4 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h4><p>eval() 函数把字符串按照 PHP 代码来计算。<br>该字符串必须是合法的 PHP 代码，且必须以分号结尾。<br>如果没有在代码字符串中调用 return 语句，则返回 NULL。如果代码中存在解析错误，则 eval() 函数返回 false。<br>assert()<br>编写代码时，我们总是会做出一些假设，断言就是用于在代码中捕捉这些假设，可以将断言看作是异常处理的一种高级形式。程序员断言在程序中的某个特定点该的表达式值为真(为真才能继续执行)。如果该表达式为假，就中断操作. 版本在PHP7以下是函数 PHP7及以上为语法结构<br><code>assert ( mixed $assertion [, Throwable $exception ] )</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eval(&quot; phpinfo()&quot;); &lt;错误&gt;</span><br><span class="line"></span><br><span class="line">eval(&quot; phpinfo();&quot;); &lt;正确&gt;</span><br><span class="line">assert(&quot; phpinfo()&quot;); &lt;正确&gt;</span><br></pre></td></tr></table></figure>
<p>scandir() 函数返回指定目录中的文件和目录的数组，$dir可以是相对路径，也可以是绝对路径<br><code>scandir($dir)</code></p>
<p>print_r() 函数用于打印变量，以更容易理解的形式展示。<br>var_dump() 函数用于输出变量的相关信息。<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715223832.png" alt="QQ截图20220715223832"></p>
<p>preg_replace() /e代码执行漏洞<br>正则表达式中的/e模式的作用是将<strong>替换串</strong>中的内容当作代码来执行，/e模式是php语言才有的，除此之外还有/i(不区分大小写)等。php5.5废除preg_replace的/e模式(不是移除)当使用被弃用的 e 修饰符时, 这个函数会转义一些字符(即：’、”、  和 NULL) 而后进行后向引用替换.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">function test($str)&#123; .......&#125;</span><br><span class="line">echo preg_replace(&quot;/s*[php](.+?)[/php]s*/ies&quot;, &#x27;test(&quot;\1&quot;)&#x27;, $_GET[&quot;h&quot;]);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
<p>在php中，<strong>双引号</strong>里面如果包含有变量，php解释器会将其替换为变量解释后的结果；<strong>单引号</strong>中的变量不会被处理。<br>我们如果提交?h=[php]{${phpinfo()}}[/php],replacement 参数变为’test(“{${phpinfo()}}”)’,phpinfo()就会被执行</p>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715211205.png" alt="QQ截图20220715211205"><br>实例<br><strong>``</strong><br>里内容作为shell命令来执行,如echo `ls`;</p>
<p>system()函数可以执行系统命令, 并将命令执行的结果直接输出到界面</p>
<p><code>system(&#39;ls&#39;)</code><br>exec()函数是被禁用的,先是 要关掉 安全模式 <code>safe_mode = off</code><br>exec(‘ls’,$result);如果result数组中已经包含了部分元素，exec() 函数会在数组末尾追加内容    </p>
<p><code>exec(&#39;ls&#39;,$result); print_r($result);</code><br>shell_exec()函数可以执行系统命令, 但它不会直接输出执行的结果, 而是返回一个字符串类型的变量来存储系统命令的执行结果</p>
<p><code>echo shell_exec(&#39;ls&#39;)</code><br>passthru()函数可以执行系统命令, 并将执行结果输出到页面中, 与system()函数不同的是, 它支持二进制的数据, 更多的用于文件, 图片等操作</p>
<p><code>passthru(&#39;ls&#39;)</code><br>popen()函数可以执行系统命令, 但不会输出执行的结果, 而是返回一个资源类型的变量用来存储系统命令的执行结果<br>$result = popen( ‘ls’ , ‘r’ );参数’1’:字符串类型,需要执行的命令,;参数2:字符串类型,模式 ;返回值:资源类型,命令执行的结果</p>
<p><code>$result = popen( &#39;ls&#39;,&#39;r&#39; ); echo fread( $result , 100 );</code></p>
<p>PHP内置的命令执行函数（如shell_exec、system），都只接受一个“字符串”作为参数。而在内核中，这个字符串将被直接作为一条shell命令来调用，这种情况下就极为容易出现命令注入漏洞。</p>
<p>由于这个特点，PHP特别准备了两个过滤函数：</p>
<pre><code>escapeshellcmd
escapeshellarg
</code></pre>
<p>二者分工不同.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数</span><br><span class="line"></span><br><span class="line">功能 ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 exec(), system() 执行运算符(反引号)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/l4sij.png" alt="l4sij"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">escapeshellcmd — shell 元字符转义</span><br><span class="line"></span><br><span class="line">功能：escapeshellcmd() 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 exec() 或 system() 函数，或者 执行操作符 之前进行转义。</span><br><span class="line"></span><br><span class="line">反斜线（\）会在以下字符之前插入： &amp;#;`|\?~&lt;&gt;^()[]&#123;&#125;$*, \x0A 和 \xFF*。 *’ 和 “ 仅在不配对儿的时候被转义。 </span><br><span class="line">在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果是先用 escapeshellarg 函数过滤,再用的 escapeshellcmd 函数过滤<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/se6sc.png" alt="se6sc"></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/php/" rel="tag"># php</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/06/26/python%E5%9F%BA%E7%A1%80/" rel="prev" title="python基础">
                  <i class="fa fa-chevron-left"></i> python基础
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/07/15/rce/" rel="next" title="rce">
                  rce <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mayylu</span>
</div>
  <div class="powered-by">تطبيق الموقع <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
